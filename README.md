# cli 的实现原理

## cli 的实现原理

如果你能回答以下 3 个问题，就掌握了 cli 的实现原理：

```
npm install -g @vue/cli
```

- 为什么全局安装 **@vue/cli** 后，操作系统中会添加一个 **vue** 的命令？（述说流程）
- 全局安装 **@vue/cli** 时发生了什么？（述说流程）
- 执行 **vue** 命令时发生了什么？为什么 **vue** 指向一个 **js** 文件，我们却可以直接通过 **vue** 命令去执行它？

---

### 为什么全局安装 **@vue/cli** 后，操作系统中会添加一个 **vue** 的命令？

全局安装 **@vue/cli** 后:
会在 本地全局 **node** 下的 **node-modules** 创建一个 **vue** 的软连接，指向：

```
vue -> ../lib/node_modules/@vue/cli/bin/vue.js
```

- 指向的地址即为： **vue** 的真身，也就是 **vue.js**。
  - 也就是说，我们真正执行的是，**vue.js** 文件，**vue** 只是一个软链接。

> 但是，为什么执行的是 **vue.js**，我们却可以用 **vue** 来执行呢？这两者的绑定关系从何而来？

原因是：

- 在源码目录，也就是 **cli** 目录下，有一个 **package.json** 的文件。
  - 在此文件下有一个配置项 **bin**，如下：

```json
{
  "bin": {
    "vue": "bin/vue.js"
  }
}
```

- 如上易知，在 **bin** 下配置了 **vue** 的配置项，将二者相关联了起来。
  - 使得 **/usr/local/bin** 下的 **vue** 命令可以链接到 **vue.js** 中去执行。

> 至于 vue 名称的确定，取决于 **/usr/local/bin** 下的 **vue** 名称，可更改此名称实现 '命令名称' 的更改。

### 全局安装 **@vue/cli** 时发生了什么？

上面其实，原理已经说的差不多了，我们从流程角度说说，全局安装 **@vue/cli** 时发生了什么：

全局安装 **@vue/cli** 时:
**node** 会将 **@vue/cli** 这个包放到 **/user/local/lib** 下的 **/node_modules** 当中。

- 当包完全下载完毕后：
  - **node** 会去解析 **/node_modules/@vue/cli** 下 **package.json** 文件中的 **bin** 配置。
  - 其中，找到 **"vue": "bin/vue.js"**，即为 **vue** 命令的配置项。
    - 随后在 **/usr/local/bin** 下根据 **bin** 对应的配置，配置好 **@vue/cli** 的执行命令名称和软链接。

### 执行 **vue** 命令时发生了什么？
### 为什么 **vue** 指向一个 **js** 文件，我们却可以直接通过 **vue** 命令去执行它？

...

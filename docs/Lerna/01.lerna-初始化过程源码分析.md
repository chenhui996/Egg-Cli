# lerna-初始化过程源码分析

- 把 lerna 整个执行的流程，捋一捋。

> IDE: WebStorem

## lerna deBug 配置

- Preferences -> Node.js -> <deBug-name> -> Node parameters: **core/lerna/cli.js ls**

> 顺着 lerna ls，了解 lerna 的整个执行流程（debug）。

## start

进入 lerna 源码入口（cli.js） -> 找到引用 importLocal 处 -> **打上断点，点击 degug**

```js
6     const importLocal = require('import-local')
```

> importLocal 后面会重点分析，此处先跳过（F8 Step over）。

```js
//...

8    if (importLocal(__filename)) {
9      require('npmlog').info('cli'， 'using local version of lerna')
10   } else {
11     require('.')(process.argv.slice(2))
12   }

```

- 现象：
  - 从 start 处的 importLocal 执行 F8，会进入 8 行。
  - 再次执行 F8，不会进入 第 9 行，而是直接进入 11 行。
- 分析：
  - 第 8 行返回 false ，故 F8 将不会 into 执行。
  - F8 将直接继续向下执行。
    - **于是就来到第 11 行。**

### require(".")

看到第 11 行：

```js
11    require('.')(process.argv.slice(2))
```

- 问题：
  - `require('.')` 是什么意思？
  - 一般不是 `require('./index.js')`，类似这种形式的吗？
  - 跟一个点是麻玩意？
- 分析：
  - 这种形式，表示相对路径。
    - `.`表示当前目录。
      - 后面不跟内容 -> 默认寻找 index.js。
      - 故`.` 等价于 `./index.js`
    - `../` 表示上层目录。
      - 同理，`../` 等价于 `../index.js`。

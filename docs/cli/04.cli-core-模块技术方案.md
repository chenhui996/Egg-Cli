# core 模块技术方案

core 模块，开发的几个阶段。

## 命令执行流程

- 准备阶段
- 命令注册
- 命令执行

---

## 准备阶段（prepare）

cli 准备阶段链路：

- **检查版本号**
  - 检查当前 cli 版本是否为一个**正常的版本号** -> 牵扯到：是否给予**更新版本**的提示。
  - 拿到版本号，还可以做很多逻辑方面的判断。
- **检查 node 版本**
  - 检查运行环境 -> 其中包含了 node 版本检查：
    - 可能我们开发调用的 node 高版本 API，不兼容低版本。
      - 故需做 node 版本检查，若 node 版本不合适，即无法向下执行。
- **检查 root 启动**
  - 检查用户是否是通过 sudo 的方式 -> 启动 cli
    - 通过 root 方式创建的文件，很有可能后续无法维护 -> 权限问题。
      - 权限问题：**其他用户无法访问**
    - 故检查到 root 启动，cli 需进行降级处理 -> 将 **root 用户启动**降级为**普通用户启动**。
      - **避免后续带来的一系列权限问题。**
- **检查用户主目录**
  - 检查当前用户是否有主目录 -> **本地缓存**需写入主目录
    - **判断**：要确保拿到用户主目录，拿不到就无法向下执行。
- **检查入参**
  - 判断：入参是否正确。
- **检查环境变量**
  - **本地缓存**相关，检查逻辑与 **检查用户主目录** 类似。
- **检查是否为最新版本**
  - 是：正常往下走
  - 否：**提示更新**

## 涉及技术点

### 核心库

- **import-local**
  - 优先执行本地 cli 命令。
- **commander**
  - 开发命令注册。

### 工具库

- **npmlog**
  - 打印日志（定制化）
- **fs-extra**
  - 文件操作
- **semver**
  - 版本比对 -> 当前版本是否是最新版本等等
- **colors**
  - 终端打印不同颜色的文本
- **user-home**
  - 快速获取用户主目录
- **dotenv**
  - 获取环境变量
- **root-check**
  - root 账户检查和自动降级
- ...

---

### 命令注册

---

### 命令执行

---
